query = Query("SELECT COUNT(1) AS n, remote_addr FROM file WHERE status = 200 AND remote_addr != '-' GROUP BY remote_addr ORDER BY n DESC LIMIT 10")


filtered = Filter(parser, lambda row:row['status'] == 200)
group_by = GroupBy(filtered, group_by="remote_addr", select=[
    lambda:Column('remote_addr'),
    lambda:SumAggregate('bytes', 'bandwidth')])
    # lambda:CountAggregate(None, 'count(1)')])
order_by = OrderBy(group_by, 'bandwidth', True)
# order_by = OrderBy(group_by, 'count(1)', True)
limit = Limit(order_by, 10)
for row in limit:
    print "%s\t%.3f" % (row['remote_addr'], row['bandwidth'] / (1024*1024*1024))
